<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SynthFX Mobile â€“ Live</title>

<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="theme-color" content="#020617">

<script src="https://cdn.tailwindcss.com"></script>

<style>
html,body{
 background:#020617;
 color:#e5e7eb;
 font-family:system-ui,-apple-system,sans-serif;
 touch-action:manipulation;
}
.section{
 border:1px solid #1e293b;
 border-radius:18px;
 padding:1rem;
}
label{font-size:.65rem;color:#9ca3af}
input[type=range]{width:100%}
select,button{
 background:#020617;
 border:1px solid #1e293b;
 border-radius:12px;
 padding:.5rem;
}
button:active{transform:scale(.95)}
</style>
</head>

<body class="p-3 max-w-md mx-auto">

<header class="text-center mb-3">
 <h1 class="text-xl font-bold">ðŸŽ¹ SynthFX</h1>
 <p class="text-[10px] text-gray-400">Live â€¢ Filter Synth â€¢ Safari</p>
</header>

<section class="section mb-3">
 <label>PRESET</label>
 <select id="presetSelect" class="w-full"></select>
 <div class="grid grid-cols-2 gap-2 mt-2">
  <button id="savePreset" class="bg-green-700 text-xs">SALVAR</button>
  <button id="deletePreset" class="bg-red-700 text-xs">APAGAR</button>
 </div>
</section>

<section class="grid grid-cols-2 gap-3 mb-3">
 <button id="powerBtn" class="py-4 bg-green-700 font-bold">LIGAR</button>
 <button id="inputBtn" class="py-4 bg-yellow-500 font-bold text-black">INPUT ON</button>
</section>

<section class="section mb-3">
 <label>INPUT GAIN</label>
 <input id="gain" type="range" min="0" max="10" step="0.1" value="3">
</section>

<section class="section mb-3">
 <label>FILTRO TIPO</label>
 <select id="filterType" class="w-full mb-2">
  <option value="lowpass">Low-Pass</option>
  <option value="highpass">High-Pass</option>
 </select>

 <label>CUTOFF</label>
 <input id="cutoff" type="range" min="100" max="12000" step="10" value="4000">

 <label class="mt-2 block">RESONANCE</label>
 <input id="resonance" type="range" min="0.5" max="15" step="0.1" value="1">
</section>

<section class="section mb-3">
 <label>DELAY MIX</label>
 <input id="delayMix" type="range" min="0" max="1" step="0.01" value="0.2">
</section>

<section class="section mb-3">
 <label>REVERB MIX</label>
 <input id="reverbMix" type="range" min="0" max="1" step="0.01" value="0.3">
</section>

<section class="section">
 <label>MASTER</label>
 <input id="volume" type="range" min="0" max="1.5" step="0.05" value="1">
</section>

<footer class="text-center text-[9px] mt-4 text-gray-500">
 SynthFX â€¢ Filter Engine â€¢ Live Safe
</footer>

<script>
const el=id=>document.getElementById(id);

let ctx, stream, input;
let gainNode, filter, delayNode, delayFB, delayMix;
let reverb, master;
let running=false;

/* ===== FACTORY PRESETS ===== */
const FACTORY={
 Clean:{g:3,f:"lowpass",c:12000,q:.7,d:0,r:.1,v:1},
 Pad:{g:4,f:"lowpass",c:3500,q:1.2,d:.2,r:.4,v:1},
 Warm:{g:4,f:"lowpass",c:1800,q:2,d:.3,r:.5,v:1},
 Thin:{g:3,f:"highpass",c:600,q:.8,d:.1,r:.2,v:1}
};

/* ===== PRESETS STORAGE ===== */
function presetsAll(){
 return {...FACTORY,...JSON.parse(localStorage.getItem("synthfx")||"{}")};
}

function loadPresets(){
 const s=el("presetSelect");
 s.innerHTML="";
 Object.keys(presetsAll()).forEach(p=>s.add(new Option(p,p)));
 applyPreset(presetsAll()[s.options[0].value]);
}

function savePreset(){
 const name=prompt("Nome do preset");
 if(!name)return;
 const saved=JSON.parse(localStorage.getItem("synthfx")||"{}");
 saved[name]=state();
 localStorage.setItem("synthfx",JSON.stringify(saved));
 loadPresets();
}

function deletePreset(){
 const name=el("presetSelect").value;
 if(FACTORY[name])return alert("Preset de fÃ¡brica");
 const s=JSON.parse(localStorage.getItem("synthfx")||"{}");
 delete s[name];
 localStorage.setItem("synthfx",JSON.stringify(s));
 loadPresets();
}

/* ===== AUDIO ===== */
el("powerBtn").onclick=async()=>{
 if(!running){
  ctx=new AudioContext({latencyHint:"interactive",sampleRate:48000});
  stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:false,noiseSuppression:false,autoGainControl:false}});
  input=ctx.createMediaStreamSource(stream);

  gainNode=ctx.createGain();
  filter=ctx.createBiquadFilter();
  delayNode=ctx.createDelay(1);
  delayFB=ctx.createGain();
  delayMix=ctx.createGain();
  reverb=ctx.createConvolver();
  master=ctx.createGain();

  delayNode.connect(delayFB).connect(delayNode);
  delayNode.connect(delayMix);

  input.connect(gainNode).connect(filter).connect(delayNode);
  filter.connect(reverb);
  delayMix.connect(reverb);
  reverb.connect(master).connect(ctx.destination);

  running=true;
  el("powerBtn").textContent="DESLIGAR";
 } else {
  ctx.close();
  stream.getTracks().forEach(t=>t.stop());
  running=false;
  el("powerBtn").textContent="LIGAR";
 }
};

/* ===== CONTROLES ===== */
["gain","cutoff","resonance","delayMix","reverbMix","volume"].forEach(id=>{
 el(id).oninput=()=>{
  if(!filter)return;
  gainNode.gain.value=el("gain").value;
  filter.type=el("filterType").value;
  filter.frequency.value=el("cutoff").value;
  filter.Q.value=el("resonance").value;
  delayMix.gain.value=el("delayMix").value;
  master.gain.value=el("volume").value;
 };
});

/* ===== PRESET APPLY ===== */
function state(){
 return {
  g:+el("gain").value,
  f:el("filterType").value,
  c:+el("cutoff").value,
  q:+el("resonance").value,
  d:+el("delayMix").value,
  r:+el("reverbMix").value,
  v:+el("volume").value
 };
}

function applyPreset(p){
 el("gain").value=p.g;
 el("filterType").value=p.f;
 el("cutoff").value=p.c;
 el("resonance").value=p.q;
 el("delayMix").value=p.d;
 el("reverbMix").value=p.r;
 el("volume").value=p.v;
}

/* ===== EVENTS ===== */
el("presetSelect").onchange=e=>applyPreset(presetsAll()[e.target.value]);
el("savePreset").onclick=savePreset;
el("deletePreset").onclick=deletePreset;

loadPresets();
</script>

</body>
</html>
